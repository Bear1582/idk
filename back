from flask import Flask, request, jsonify
import sqlite3
import time

app = Flask(__name__)

conn = sqlite3.connect('forum.db')
c = conn.cursor()
c.execute('''CREATE TABLE IF NOT EXISTS messages
             (id INTEGER PRIMARY KEY AUTOINCREMENT, message TEXT, timestamp INTEGER)''')
conn.commit()

@app.route('/post_message', methods=['POST'])
def post_message():
    data = request.get_json()
    message = data['message']
    timestamp = time.time()
    c.execute("INSERT INTO messages (message, timestamp) VALUES (?, ?)", (message, timestamp))
    conn.commit()
    return 'Message posted successfully', 200

@app.route('/view_messages')
def view_messages():
    messages = c.execute("SELECT * FROM messages").fetchall()
    messages_data = [{'message': message[1]} for message in messages]
    return jsonify({'messages': messages_data})

if __name__ == '__main__':
    app.run()
